{"version":3,"sources":["uni-app:///src/main.js","webpack:///./src/pages/index/tabbar/home.vue?f7e0","webpack:///./src/pages/index/tabbar/home.vue?cc92","webpack:///./src/pages/index/tabbar/home.vue?ef8d","webpack:///./src/pages/index/tabbar/home.vue?00c4","uni-app:///src/pages/index/tabbar/home.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;;;AAAA;;AACA;;AACA;;;;AAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AACsI;AACtI,gBAAgB,gJAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,uMAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAgd,CAAgB,6dAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACiCpe;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;eAYA;AACA,cADA;AAGA;AACA,8BADA;AAEA,4BAFA;AAGA;AAHA,GAHA;AASA;AACA,QAVA,kBAUA,KAVA,EAUA;AAMA;AACA,8EAPA,CASA;;AACA;AAEA;AAEA;AACA;;AAEA;AACA;AACA,KAFA,MAEA;AACA;AACA;;AAEA;AAEA,GAnCA;AAqCA,QArCA,oBAqCA;AACA;AACA;AACA;AADA;AAGA,GA1CA;AA4CA,MA5CA,kBA4CA;AACA;AACA,mBADA;AAEA,gDAFA,CAEA;;AAFA;AAIA,GAjDA;AAmDA,4CACA,kCADA;AAGA,QAHA,kBAGA;AAAA;;AACA;AAAA;AAAA;AACA;AALA,IAnDA;AA2DA,2CACA,oDADA;AAGA;AACA,UAJA,oBAIA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AANA;AAQA,KAbA;AAeA;AACA,UAhBA,oBAgBA;AACA;AACA,KAlBA;AAoBA;AACA,eArBA,yBAqBA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,SADA;AAAA;AAAA;AAAA;;AAEA;AACA,iCADA;AAEA,oCAFA;AAGA;AAHA;AAKA;AAPA;;AAAA;AAAA;AAAA,uBAWA;AAAA;AAAA,kBAXA;;AAAA;AAAA;AAWA,oBAXA,yBAWA,IAXA;;AAaA;;AAEA;;AAEA;;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBA,KAvCA;AAyCA;AACA,qBA1CA,6BA0CA,OA1CA,EA0CA;AAAA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA,SAJA,MAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAbA;AAeA;AACA,KA/DA;AAiEA;AACA,mBAlEA,6BAkEA;AAAA;;AACA;AAEA;AACA;AACA;AACA;AACA;;AACA;;AACA;;AACA;AACA;AACA;AACA,OAVA;AAWA,KAhFA;AAkFA;AACA,eAnFA,uBAmFA,KAnFA,EAmFA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA,EAIA,EAJA;AAKA,KA1FA;AA4FA;AACA,mBA7FA,6BA6FA;AAAA;;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA;AAjGA;AA3DA,C","file":"pages/index/tabbar/home.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/index/tabbar/home.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./home.vue?vue&type=template&id=2973e58a&\"\nvar renderjs\nimport script from \"./home.vue?vue&type=script&lang=js&\"\nexport * from \"./home.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/tabbar/home.vue\"\nexport default component.exports","export * from \"-!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--15-0!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=template&id=2973e58a&\"","var components\ntry {\n  components = {\n    globalTabPage: function () {\n      return import(\n        /* webpackChunkName: \"components/global/global-tab-page\" */ \"@/components/global/global-tab-page.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=script&lang=js&\"","<!--\n * @Description: 自定义渲染页面\n *  \n * @Date: 2022-01-19 16:12:04\n *   \n * @LastEditTime: 2024-04-13 17:31:33\n-->\n<template>\n  <global-tab-page>\n    <!-- 自定义首页物料渲染 -->\n    <template v-if=\"page\">\n      <custom-top-bar\n        :title=\"project.name\"\n        :isTop=\"false\"\n        :shadow=\"true\"\n      ></custom-top-bar>\n\n      <render-widget\n        v-for=\"item in page.componentList\"\n        :key=\"item.id\"\n        :item=\"item\"\n      ></render-widget>\n    </template>\n\n    <!-- loading -->\n    <full-loading :show=\"loading\" bgColor=\"#FFFFFF\"></full-loading>\n  </global-tab-page>\n</template>\n\n<script>\nimport CustomTopBar from \"@/components/custom-top-bar.vue\";\nimport RenderWidget from \"@/components/render-widget\";\nimport FullLoading from \"@/components/full-loading.vue\";\nimport { mapMutations, mapGetters } from \"vuex\";\nimport { getProjectDetail } from \"@/api/index\";\n\nlet projectId;\n\n// #ifdef H5\nconsole.log(\"H5 环境\");\nimport parseQueryString from \"@/utils/parseQueryString\";\nlet { operate, id } = parseQueryString();\n\n// 默认预览操作\noperate = operate || \"view\";\nprojectId = id;\n// #endif\n\nexport default {\n  name: \"home\",\n\n  components: {\n    RenderWidget,\n    FullLoading,\n    CustomTopBar,\n  },\n\n  // 进入项目初始化\n  onLoad(query) {\n    // #ifdef H5\n    this.initH5();\n    // #endif\n\n    // #ifdef MP\n    // 当前外部传入的项目id\n    let id = this.formatQuery(decodeURIComponent(query.scene)).id || query.id;\n\n    // 上一次渲染保存的项目id\n    let lastProjectId = uni.getStorageSync(\"projectId\");\n\n    projectId = id || lastProjectId || this.auditProjectId;\n\n    console.log(\"小程序环境\");\n    console.log(`当前商城id：${projectId}`);\n\n    if (projectId == this.auditProjectId) {\n      this.enterAuth();\n    } else {\n      uni.setStorageSync(\"projectId\", projectId);\n    }\n\n    this.initMP();\n    // #endif\n  },\n\n  onShow() {\n    // 每次进入页面，返回顶部\n    wx.pageScrollTo({\n      scrollTop: 0,\n    });\n  },\n\n  data() {\n    return {\n      loading: true,\n      auditProjectId: \"62009795c163ee452d3b35b1\", // 默认模板项目id,用于小程序审核\n    };\n  },\n\n  computed: {\n    ...mapGetters([\"project\"]),\n\n    page() {\n      return this.project?.pages?.find((page) => page.home);\n    },\n  },\n\n  methods: {\n    ...mapMutations([\"setProject\", \"enterAuth\"]),\n\n    // 初始化 - H5环境\n    initH5() {\n      switch (operate) {\n        case \"realTime\":\n          this.listenerMessage();\n          break;\n        case \"view\":\n          this.initProject();\n          break;\n      }\n    },\n\n    // 初始化 - 小程序环境\n    initMP() {\n      this.initProject();\n    },\n\n    // 获取商城数据，初始化商城\n    async initProject() {\n      if (!projectId) {\n        uni.showModal({\n          title: \"商城加载失败\",\n          content: \"请传入参数id\",\n          showCancel: false,\n        });\n        this.loading = false;\n        return;\n      }\n\n      let { data } = await getProjectDetail({ id: projectId });\n\n      this.formatProjectData(data);\n\n      this.setProject(data);\n\n      this.loadingComplete();\n    },\n\n    // 处理项目数据格式（老数据结构，不满足小程序版本）\n    formatProjectData(project) {\n      // 处理tabbar列表\n      const list = project?.config?.navigation?.list || [];\n      let paths = [\"tab-frist\", \"tab-second\", \"tab-third\"];\n\n      list.forEach((item, index) => {\n        if (index == 0) {\n          item.jump.name = item.jump.type = \"home\";\n          item.jump.path = `/pages/index/tabbar/home`;\n          uni.setStorageSync(\"jump\", item);\n        } else {\n          let type = paths.shift();\n          item.jump.name = item.jump.type = type;\n          item.jump.path = `/pages/index/tabbar/${type}`;\n        }\n\n        const fonts = item.icon.split(\"-\");\n        if (fonts.length == 2) item.icon = fonts[1];\n      });\n\n      console.log(list);\n    },\n\n    // iframe通信，接收项目数据实时预览\n    listenerMessage() {\n      console.log(\"iframe通信，接收项目数据实时预览\");\n\n      window.addEventListener(\"message\", (e) => {\n        if (e.data) {\n          // 如果本地启动admin 和 h5 ，iframe传输会多传输一次webpack警告\n          if (e.data.id) {\n            let project = e.data;\n            this.formatProjectData(project);\n            this.setProject(project);\n            this.loading = false;\n          }\n        }\n      });\n    },\n\n    // 格式化query\n    formatQuery(query) {\n      query = query.split(\"&\");\n      return query.reduce((params, item) => {\n        let q = item.split(\"=\");\n        if (q.length === 2) params[q[0]] = q[1];\n        return params;\n      }, {});\n    },\n\n    // 加载完成，取消loading  小程序渲染卡顿，多加载一会，优化体验效果\n    loadingComplete() {\n      setTimeout(() => {\n        this.loading = false;\n      }, 1000);\n    },\n  },\n};\n</script>"],"sourceRoot":""}